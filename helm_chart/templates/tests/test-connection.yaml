{{- if .Values.service.enabled }}
apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "local-storage-exporter.fullname" . }}-test-connection"
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "local-storage-exporter.labels" . | nindent 4 }}
    {{- with .Values.tests.labels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  annotations:
    "helm.sh/hook": test
    {{- with .Values.tests.annotations }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
spec:
  containers:
    - name: wget
      image: "{{ .Values.tests.image.repository }}:{{ .Values.tests.image.tag }}"
      command: {{ .Values.tests.command }}
      args:
        {{- range .Values.tests.args }}
        - {{ tpl . $ }}
        {{- end }}
  restartPolicy: Never
{{- end }}
